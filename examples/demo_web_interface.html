<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuminaOps Data Usage Examples</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            color: #666;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .demo-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .demo-card h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .demo-card .icon {
            font-size: 1.8em;
        }
        
        .demo-card p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .example-code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .status {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .response-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
        
        .dataset-info {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .dataset-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .quick-start {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .quick-start h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ LuminaOps Data Usage Examples</h1>
            <p>Interactive demonstrations using real sample datasets</p>
        </div>

        <div class="quick-start">
            <h2>üö¶ Quick Start Guide</h2>
            <div class="step">
                <div class="step-number">1</div>
                <div>Make sure the LuminaOps backend is running on <strong>http://localhost:8000</strong></div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div>Click "Check Server Status" below to verify connection</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div>Try the AI Assistant or AutoML examples using our sample datasets</div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="checkServerStatus()">üîç Check Server Status</button>
            </div>
            <div id="serverStatus"></div>
        </div>

        <div class="demo-grid">
            <!-- AI Assistant Demo -->
            <div class="demo-card">
                <h3><span class="icon">ü§ñ</span> AI Assistant Demo</h3>
                <p>Ask questions about machine learning, data analysis, and get intelligent responses.</p>
                
                <div class="dataset-info">
                    <h4>üìä Using: Customer Sample Data</h4>
                    <ul>
                        <li>20 customer records</li>
                        <li>Features: age, income, satisfaction</li>
                        <li>Target: churn prediction</li>
                    </ul>
                </div>
                
                <div class="example-code">
POST /api/v1/ai/llm/generate
{
  "prompt": "Analyze customer churn patterns...",
  "temperature": 0.7
}
                </div>
                
                <button class="btn" onclick="testAIAssistant()">üöÄ Ask AI About Customer Data</button>
                <div id="aiResponse"></div>
            </div>

            <!-- AutoML Simple Demo -->
            <div class="demo-card">
                <h3><span class="icon">üî¨</span> AutoML - Simple Churn</h3>
                <p>Train a customer churn prediction model automatically using FLAML.</p>
                
                <div class="dataset-info">
                    <h4>üìä Training Configuration</h4>
                    <ul>
                        <li>Algorithm: FLAML</li>
                        <li>Problem: Classification</li>
                        <li>Time Budget: 60 seconds</li>
                    </ul>
                </div>
                
                <div class="example-code">
POST /api/v1/ai/automl/train
{
  "target_column": "churn",
  "problem_type": "classification",
  "data": {...}
}
                </div>
                
                <button class="btn" onclick="testAutoMLSimple()">üî¨ Train Churn Model</button>
                <div id="automlSimpleResponse"></div>
            </div>

            <!-- AutoML Advanced Demo -->
            <div class="demo-card">
                <h3><span class="icon">‚ö°</span> AutoML - Advanced Model</h3>
                <p>Train with richer customer features for improved accuracy using XGBoost.</p>
                
                <div class="dataset-info">
                    <h4>üìä Enhanced Features</h4>
                    <ul>
                        <li>Demographics + Behavioral data</li>
                        <li>Website visits, lifetime value</li>
                        <li>Algorithm: XGBoost</li>
                    </ul>
                </div>
                
                <div class="example-code">
Features: age, income, satisfaction_score,
         website_visits, lifetime_value,
         marketing_spend
                </div>
                
                <button class="btn" onclick="testAutoMLAdvanced()">‚ö° Train Advanced Model</button>
                <div id="automlAdvancedResponse"></div>
            </div>

            <!-- Time Series Demo -->
            <div class="demo-card">
                <h3><span class="icon">üìà</span> Time Series Regression</h3>
                <p>Predict model accuracy based on performance metrics over time.</p>
                
                <div class="dataset-info">
                    <h4>üìä Model Metrics</h4>
                    <ul>
                        <li>Predict: accuracy</li>
                        <li>From: latency, throughput, error_rate</li>
                        <li>Algorithm: FLAML Regression</li>
                    </ul>
                </div>
                
                <div class="example-code">
Target: model_accuracy
Features: latency, throughput, error_rate
Use Case: Model monitoring & alerting
                </div>
                
                <button class="btn" onclick="testTimeSeriesML()">üìà Train Regression Model</button>
                <div id="timeseriesResponse"></div>
            </div>
        </div>

        <!-- Results Comparison -->
        <div class="quick-start">
            <h2>üìä Results Comparison</h2>
            <p>Run multiple examples above to see how different approaches perform on the same business problem.</p>
            <div id="comparison"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1/ai';
        let results = {};

        async function checkServerStatus() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.innerHTML = '<div class="loading">Checking server connection...</div>';
            
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ Server is running! ${data.service} v${data.version}
                        </div>
                    `;
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå Server not running! Please start the backend first:<br>
                        <code>cd backend && python -m uvicorn main:app --port 8000</code>
                    </div>
                `;
            }
        }

        async function testAIAssistant() {
            const responseDiv = document.getElementById('aiResponse');
            responseDiv.innerHTML = '<div class="loading">ü§ñ AI is analyzing customer data...</div>';
            
            try {
                const prompt = `I have customer data with these insights:
                - 20 customer records with 10% churn rate
                - Features: age (26-55), income ($48K-$95K), satisfaction (3.5-4.8)
                - Lower satisfaction scores correlate with churn
                
                What are the key business insights and recommended actions?`;
                
                const response = await fetch(`${API_BASE}/llm/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    responseDiv.innerHTML = `
                        <div class="status success">‚úÖ AI Analysis Complete</div>
                        <div class="response-box">
                            <strong>üß† AI Insights:</strong><br>
                            ${data.response.replace(/\\n/g, '<br>')}
                        </div>
                    `;
                    results.ai = data;
                } else {
                    throw new Error(data.detail || 'AI request failed');
                }
            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="status error">‚ùå Error: ${error.message}</div>
                `;
            }
            updateComparison();
        }

        async function testAutoMLSimple() {
            const responseDiv = document.getElementById('automlSimpleResponse');
            responseDiv.innerHTML = '<div class="loading">üî¨ Training simple churn model (60 seconds)...</div>';
            
            try {
                const trainingData = {
                    request: {
                        target_column: "churn",
                        problem_type: "classification",
                        model_type: "flaml",
                        time_budget: 60,
                        test_size: 0.2
                    },
                    data: {
                        age: [32, 45, 28, 38, 29, 55, 26, 41, 34, 31],
                        income: [65000, 85000, 52000, 72000, 58000, 95000, 48000, 78000, 62000, 69000],
                        purchase_amount: [1250.50, 2100.75, 680.25, 1850.00, 420.80, 280.50, 350.75, 1950.25, 890.40, 1200.30],
                        satisfaction_score: [4.2, 4.8, 3.9, 4.5, 4.1, 4.7, 3.5, 4.6, 4.0, 4.3],
                        churn: [0, 0, 0, 0, 0, 0, 1, 0, 0, 0]
                    }
                };
                
                const response = await fetch(`${API_BASE}/automl/train`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trainingData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const topFeature = Object.entries(data.feature_importance)
                        .sort(([,a], [,b]) => b - a)[0];
                    
                    responseDiv.innerHTML = `
                        <div class="status success">‚úÖ Model Trained Successfully!</div>
                        <div class="response-box">
                            <strong>üìä Results:</strong><br>
                            ‚Ä¢ Accuracy: <strong>${(data.score * 100).toFixed(1)}%</strong><br>
                            ‚Ä¢ Algorithm: ${data.config.algorithm || 'FLAML'}<br>
                            ‚Ä¢ Top Feature: <strong>${topFeature[0]}</strong> (${topFeature[1].toFixed(3)})<br>
                            ‚Ä¢ Model ID: ${data.model_id}
                        </div>
                    `;
                    results.simple = data;
                } else {
                    throw new Error(data.detail || 'Training failed');
                }
            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="status error">‚ùå Training Error: ${error.message}</div>
                `;
            }
            updateComparison();
        }

        async function testAutoMLAdvanced() {
            const responseDiv = document.getElementById('automlAdvancedResponse');
            responseDiv.innerHTML = '<div class="loading">‚ö° Training advanced model with rich features (120 seconds)...</div>';
            
            try {
                const trainingData = {
                    request: {
                        target_column: "churn",
                        problem_type: "classification", 
                        model_type: "xgboost",
                        time_budget: 120,
                        test_size: 0.25
                    },
                    data: {
                        age: [32, 45, 28, 38, 29, 55, 26, 41, 34],
                        income: [65000, 85000, 52000, 72000, 58000, 95000, 48000, 78000, 62000],
                        satisfaction_score: [4.2, 4.8, 3.9, 4.5, 4.1, 4.7, 3.5, 4.6, 4.0],
                        website_visits: [12, 18, 9, 15, 7, 5, 6, 16, 10],
                        customer_lifetime_value: [5200.75, 8900.25, 3200.50, 7200.00, 2800.60, 4500.25, 1800.30, 8100.40, 4200.80],
                        marketing_spend: [150.25, 200.00, 120.50, 175.75, 110.25, 90.00, 85.50, 185.00, 135.75],
                        churn: [0, 0, 0, 0, 0, 0, 1, 0, 0]
                    }
                };
                
                const response = await fetch(`${API_BASE}/automl/train`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trainingData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const topFeatures = Object.entries(data.feature_importance)
                        .sort(([,a], [,b]) => b - a).slice(0, 3);
                    
                    responseDiv.innerHTML = `
                        <div class="status success">‚úÖ Advanced Model Trained!</div>
                        <div class="response-box">
                            <strong>üéØ Advanced Results:</strong><br>
                            ‚Ä¢ Accuracy: <strong>${(data.score * 100).toFixed(1)}%</strong><br>
                            ‚Ä¢ Algorithm: ${data.config.algorithm || 'XGBoost'}<br>
                            ‚Ä¢ Top 3 Features:<br>
                            ${topFeatures.map(([name, score]) => 
                                `&nbsp;&nbsp;‚Ä¢ ${name}: ${score.toFixed(3)}`
                            ).join('<br>')}<br>
                            ‚Ä¢ Model ID: ${data.model_id}
                        </div>
                    `;
                    results.advanced = data;
                } else {
                    throw new Error(data.detail || 'Advanced training failed');
                }
            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="status error">‚ùå Advanced Training Error: ${error.message}</div>
                `;
            }
            updateComparison();
        }

        async function testTimeSeriesML() {
            const responseDiv = document.getElementById('timeseriesResponse');
            responseDiv.innerHTML = '<div class="loading">üìà Training time series regression model...</div>';
            
            try {
                const trainingData = {
                    request: {
                        target_column: "accuracy",
                        problem_type: "regression",
                        model_type: "flaml", 
                        time_budget: 90,
                        test_size: 0.3
                    },
                    data: {
                        latency: [45.2, 43.8, 47.1, 44.5, 46.3, 42.9, 48.7, 45.6, 44.2, 46.8],
                        throughput: [850, 865, 840, 875, 860, 890, 835, 870, 880, 855],
                        error_rate: [0.023, 0.021, 0.025, 0.020, 0.024, 0.018, 0.027, 0.022, 0.019, 0.025],
                        accuracy: [0.942, 0.945, 0.939, 0.948, 0.941, 0.952, 0.936, 0.944, 0.950, 0.940]
                    }
                };
                
                const response = await fetch(`${API_BASE}/automl/train`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trainingData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    responseDiv.innerHTML = `
                        <div class="status success">‚úÖ Regression Model Trained!</div>
                        <div class="response-box">
                            <strong>üìà Time Series Results:</strong><br>
                            ‚Ä¢ R¬≤ Score: <strong>${data.score.toFixed(3)}</strong><br>
                            ‚Ä¢ Problem: Accuracy Prediction<br>
                            ‚Ä¢ Use Case: Model Monitoring<br>
                            ‚Ä¢ Key Predictors: ${Object.keys(data.feature_importance).slice(0, 2).join(', ')}<br>
                            ‚Ä¢ Model ID: ${data.model_id}
                        </div>
                    `;
                    results.timeseries = data;
                } else {
                    throw new Error(data.detail || 'Regression training failed');
                }
            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="status error">‚ùå Regression Error: ${error.message}</div>
                `;
            }
            updateComparison();
        }

        function updateComparison() {
            const comparisonDiv = document.getElementById('comparison');
            
            if (Object.keys(results).length === 0) {
                comparisonDiv.innerHTML = '<p>Run examples above to see performance comparison...</p>';
                return;
            }
            
            let comparison = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">';
            
            if (results.simple && results.advanced) {
                const improvement = ((results.advanced.score - results.simple.score) / results.simple.score) * 100;
                comparison += `
                    <div class="dataset-info">
                        <h4>üÜö Churn Model Comparison</h4>
                        <p><strong>Simple:</strong> ${(results.simple.score * 100).toFixed(1)}% accuracy</p>
                        <p><strong>Advanced:</strong> ${(results.advanced.score * 100).toFixed(1)}% accuracy</p>
                        <p><strong>Improvement:</strong> ${improvement > 0 ? '+' : ''}${improvement.toFixed(1)}%</p>
                    </div>
                `;
            }
            
            if (results.timeseries) {
                comparison += `
                    <div class="dataset-info">
                        <h4>üìä Regression Performance</h4>
                        <p><strong>R¬≤ Score:</strong> ${results.timeseries.score.toFixed(3)}</p>
                        <p><strong>Use Case:</strong> Model Monitoring</p>
                        <p><strong>Prediction:</strong> Accuracy from metrics</p>
                    </div>
                `;
            }
            
            comparison += '</div>';
            comparisonDiv.innerHTML = comparison;
        }

        // Auto-check server status on page load
        window.addEventListener('load', checkServerStatus);
    </script>
</body>
</html>